
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ДНК Шифратор & Распределённое Хранилище</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <header class="header">
    <h1>Распределённое Хранилище Информации в Виде ДНК</h1>
  </header>

  <main class="container">
    <!-- Блок Шифратор/Дешифратор -->
    <section class="card">
      <h2>1. Шифратор ↔ ДНК</h2>
      <textarea id="user-input" placeholder="Введите текст для шифрования..."></textarea>
      <div class="text-counter">Байты: 0 / 1024</div>
      <button id="encodeButton" class="btn">Сгенерировать ДНК</button>
      <textarea id="dna-output" readonly placeholder="Здесь появится ДНК-последовательность..."></textarea>
      <button id="decodeButton" class="btn">Расшифровать из ДНК</button>
      <textarea id="decoded-text" readonly placeholder="Расшифрованный текст..."></textarea>
    </section>

    <!-- Блок Helia -->
    <section class="card">
      <h2>2. Распределённое Хранилище</h2>
      <div class="controls">
        <button id="startNode" class="btn">Запустить Узел</button>
        <button id="stopNode" class="btn">Остановить Узел</button>
      </div>
      <p>Статус: <span id="status">Offline</span></p>

      <h3>Загрузить и Предпросмотр</h3>
      <input type="file" id="fileInput">
      <button id="uploadBtn" class="btn">Загрузить Файл</button>
      <p>CID: <span id="cidOutput">—</span></p>
      <div id="preview" class="preview"></div>

      <h3>Получить по CID</h3>
      <input type="text" id="cidInput" placeholder="Введите CID">
      <button id="retrieveBtn" class="btn">Получить Контент</button>
      <pre id="retrievedContent" class="preview">—</pre>

      <h3>Список Директории</h3>
      <input type="text" id="dirCidInput" placeholder="CID директории">
      <button id="listBtn" class="btn">Показать Содержимое</button>
      <ul id="listOutput" class="preview-list"></ul>
    </section>
  </main>

    <script src="https://cdn.jsdelivr.net/npm/helia@^3.0.0/dist/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@helia/unixfs@^2.0.0/dist/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/libp2p@^1.0.0/dist/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@chainsafe/libp2p-yamux@^6.0.0/dist/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@chainsafe/libp2p-noise@^15.0.0/dist/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@libp2p/websockets@^8.0.0/dist/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@libp2p/bootstrap@^10.0.0/dist/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/blockstore-core@^4.0.0/dist/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/datastore-core@^9.0.0/dist/index.min.js"></script>
    <script>
let helia, unixfs;
const statusEl = document.getElementById('status');

async function start() {
  statusEl.textContent = 'Starting...';
  ({ helia, unixfs } = await initHelia([/* bootstrap peers */]));
  statusEl.textContent = 'Online';
}
function stop() { statusEl.textContent = 'Offline'; }

// UI Bindings
document.getElementById('startNode').onclick = start;
document.getElementById('stopNode').onclick = stop;

const fileInput = document.getElementById('fileInput');
const previewEl = document.getElementById('preview');
fileInput.onchange = () => previewLocalFile(fileInput.files[0], previewEl);

// Upload
const cidOutput = document.getElementById('cidOutput');
document.getElementById('uploadBtn').onclick = async () => {
  const cid = await addFile(unixfs, fileInput.files[0]);
  cidOutput.textContent = cid;
};

// Retrieve
const cidInput = document.getElementById('cidInput');
const retrieveEl = document.getElementById('retrievedContent');
document.getElementById('retrieveBtn').onclick = async () => {
  retrieveEl.textContent = await catFile(unixfs, cidInput.value);
};

// List
const dirInput = document.getElementById('dirCidInput');
const listEl = document.getElementById('listOutput');
document.getElementById('listBtn').onclick = async () => {
  listEl.innerHTML = '';
  const items = await listDir(unixfs, dirInput.value);
  items.forEach(i => listEl.innerHTML += `<li>${i.name}: ${i.cid}</li>`);
};
    </script>

   <script>
export function previewLocalFile(file, container) {
  const reader = new FileReader();
  reader.onload = e => {
    container.innerHTML = '';
    const url = e.target.result;
    if (file.type.startsWith('image/')) container.innerHTML = `<img src="${url}" />`;
    else if (file.type.startsWith('video/')) container.innerHTML = `<video controls src="${url}"></video>`;
    else if (file.type.startsWith('audio/')) container.innerHTML = `<audio controls src="${url}"></audio>`;
    else container.textContent = 'Preview not supported';
  };
  reader.readAsDataURL(file);
}

export async function addFile(unixfs, file) {
  const array = new Uint8Array(await file.arrayBuffer());
  const { cid } = await unixfs.addBytes(array);
  return cid.toString();
}

export async function catFile(unixfs, cid) {
  let content = '';
  const decoder = new TextDecoder();
  for await (const chunk of unixfs.cat(cid)) content += decoder.decode(chunk, { stream: true });
  return content;
}

export async function listDir(unixfs, cid) {
  const entries = [];
  for await (const entry of unixfs.ls(cid)) entries.push({ name: entry.name, cid: entry.cid.toString() });
  return entries;
}
</script>

</body>
</html>
